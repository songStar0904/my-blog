<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何在 JS 代码中消灭 for 循环 | songStar</title>
    <meta name="description" content="在我入职上一家公司的第一天，看到代码库里面一堆的 for 循环，内心有些崩溃，于是做了一次技术分享，展示怎样在代码中避免 for 循环。这篇文章是那次分享的总结。至于为什么我提倡避免 for 循环，参考我写的这篇文章。本文并不完美，其中递归的部分其">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no">
  <link rel="icon" href="logo.jpg">
    
    <link rel="preload" href="/my-blog/assets/css/0.styles.225419fd.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.d514aa34.js" as="script"><link rel="preload" href="/my-blog/assets/js/6.174b3b94.js" as="script"><link rel="preload" href="/my-blog/assets/js/19.a791327b.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/10.f20c0927.js"><link rel="prefetch" href="/my-blog/assets/js/11.d67f5174.js"><link rel="prefetch" href="/my-blog/assets/js/12.9b2edfda.js"><link rel="prefetch" href="/my-blog/assets/js/13.221a1f7d.js"><link rel="prefetch" href="/my-blog/assets/js/14.2451db7a.js"><link rel="prefetch" href="/my-blog/assets/js/15.f2fee083.js"><link rel="prefetch" href="/my-blog/assets/js/16.dbe22474.js"><link rel="prefetch" href="/my-blog/assets/js/17.f516c32f.js"><link rel="prefetch" href="/my-blog/assets/js/18.c985204f.js"><link rel="prefetch" href="/my-blog/assets/js/2.ed1d4fc5.js"><link rel="prefetch" href="/my-blog/assets/js/20.6baddb98.js"><link rel="prefetch" href="/my-blog/assets/js/21.6f04a48e.js"><link rel="prefetch" href="/my-blog/assets/js/22.d995e075.js"><link rel="prefetch" href="/my-blog/assets/js/23.f5e41862.js"><link rel="prefetch" href="/my-blog/assets/js/24.b7740205.js"><link rel="prefetch" href="/my-blog/assets/js/25.d19622da.js"><link rel="prefetch" href="/my-blog/assets/js/26.04c750bc.js"><link rel="prefetch" href="/my-blog/assets/js/27.174a2f01.js"><link rel="prefetch" href="/my-blog/assets/js/28.d990ccec.js"><link rel="prefetch" href="/my-blog/assets/js/29.427dc7d1.js"><link rel="prefetch" href="/my-blog/assets/js/3.81f24e3d.js"><link rel="prefetch" href="/my-blog/assets/js/30.dc28c5d5.js"><link rel="prefetch" href="/my-blog/assets/js/31.51048de5.js"><link rel="prefetch" href="/my-blog/assets/js/32.7cbd68c0.js"><link rel="prefetch" href="/my-blog/assets/js/33.76709059.js"><link rel="prefetch" href="/my-blog/assets/js/34.acfaba0d.js"><link rel="prefetch" href="/my-blog/assets/js/35.41562a62.js"><link rel="prefetch" href="/my-blog/assets/js/36.0b235249.js"><link rel="prefetch" href="/my-blog/assets/js/37.675ca40f.js"><link rel="prefetch" href="/my-blog/assets/js/38.cb76519e.js"><link rel="prefetch" href="/my-blog/assets/js/39.f425f621.js"><link rel="prefetch" href="/my-blog/assets/js/4.26b5f3d4.js"><link rel="prefetch" href="/my-blog/assets/js/40.f10640e7.js"><link rel="prefetch" href="/my-blog/assets/js/41.40ac2bb6.js"><link rel="prefetch" href="/my-blog/assets/js/42.67374738.js"><link rel="prefetch" href="/my-blog/assets/js/43.47d1da7a.js"><link rel="prefetch" href="/my-blog/assets/js/44.d322de68.js"><link rel="prefetch" href="/my-blog/assets/js/45.9c4ab4e8.js"><link rel="prefetch" href="/my-blog/assets/js/46.9b2611ac.js"><link rel="prefetch" href="/my-blog/assets/js/47.4275b067.js"><link rel="prefetch" href="/my-blog/assets/js/48.c1d28189.js"><link rel="prefetch" href="/my-blog/assets/js/49.01483e97.js"><link rel="prefetch" href="/my-blog/assets/js/5.38649c44.js"><link rel="prefetch" href="/my-blog/assets/js/50.47577bc0.js"><link rel="prefetch" href="/my-blog/assets/js/51.1b96e8cf.js"><link rel="prefetch" href="/my-blog/assets/js/52.4993006d.js"><link rel="prefetch" href="/my-blog/assets/js/53.f14ceacd.js"><link rel="prefetch" href="/my-blog/assets/js/54.3792572c.js"><link rel="prefetch" href="/my-blog/assets/js/55.7946da41.js"><link rel="prefetch" href="/my-blog/assets/js/56.5338c044.js"><link rel="prefetch" href="/my-blog/assets/js/57.570c3331.js"><link rel="prefetch" href="/my-blog/assets/js/58.77b95504.js"><link rel="prefetch" href="/my-blog/assets/js/59.f1039761.js"><link rel="prefetch" href="/my-blog/assets/js/60.18d3c8a6.js"><link rel="prefetch" href="/my-blog/assets/js/61.8428f3da.js"><link rel="prefetch" href="/my-blog/assets/js/62.c6edaacd.js"><link rel="prefetch" href="/my-blog/assets/js/63.82aa654e.js"><link rel="prefetch" href="/my-blog/assets/js/64.36231c8c.js"><link rel="prefetch" href="/my-blog/assets/js/65.f9afa1d3.js"><link rel="prefetch" href="/my-blog/assets/js/66.aee1aa3a.js"><link rel="prefetch" href="/my-blog/assets/js/67.9c6887a1.js"><link rel="prefetch" href="/my-blog/assets/js/68.d0e28429.js"><link rel="prefetch" href="/my-blog/assets/js/69.13026813.js"><link rel="prefetch" href="/my-blog/assets/js/7.ea5a4b9d.js"><link rel="prefetch" href="/my-blog/assets/js/70.d71a9b34.js"><link rel="prefetch" href="/my-blog/assets/js/71.862e5553.js"><link rel="prefetch" href="/my-blog/assets/js/72.7e922a93.js"><link rel="prefetch" href="/my-blog/assets/js/73.d0341975.js"><link rel="prefetch" href="/my-blog/assets/js/74.55838165.js"><link rel="prefetch" href="/my-blog/assets/js/75.375d2e08.js"><link rel="prefetch" href="/my-blog/assets/js/76.1ba7389b.js"><link rel="prefetch" href="/my-blog/assets/js/77.17fc5284.js"><link rel="prefetch" href="/my-blog/assets/js/78.58020eea.js"><link rel="prefetch" href="/my-blog/assets/js/79.bb700cb8.js"><link rel="prefetch" href="/my-blog/assets/js/8.12538955.js"><link rel="prefetch" href="/my-blog/assets/js/80.8b28916a.js"><link rel="prefetch" href="/my-blog/assets/js/81.58c4596b.js"><link rel="prefetch" href="/my-blog/assets/js/82.3b30eefd.js"><link rel="prefetch" href="/my-blog/assets/js/83.1a78a02f.js"><link rel="prefetch" href="/my-blog/assets/js/84.d7ddb0a6.js"><link rel="prefetch" href="/my-blog/assets/js/85.5c8c3c9f.js"><link rel="prefetch" href="/my-blog/assets/js/86.d94a61f8.js"><link rel="prefetch" href="/my-blog/assets/js/87.cf9c76b2.js"><link rel="prefetch" href="/my-blog/assets/js/88.d3faa7a9.js"><link rel="prefetch" href="/my-blog/assets/js/89.5fa1fdbb.js"><link rel="prefetch" href="/my-blog/assets/js/9.0b7150ec.js"><link rel="prefetch" href="/my-blog/assets/js/90.225017bf.js"><link rel="prefetch" href="/my-blog/assets/js/91.45ad2b96.js"><link rel="prefetch" href="/my-blog/assets/js/92.32f32ad0.js"><link rel="prefetch" href="/my-blog/assets/js/93.3638efa1.js"><link rel="prefetch" href="/my-blog/assets/js/94.df9f75c9.js"><link rel="prefetch" href="/my-blog/assets/js/95.343a44b0.js"><link rel="prefetch" href="/my-blog/assets/js/96.27cfc644.js"><link rel="prefetch" href="/my-blog/assets/js/97.461c381c.js"><link rel="prefetch" href="/my-blog/assets/js/98.9a8da1dc.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.225419fd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="page-main"><header class="component-nav-menu nav-bar"><i class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></i> <div class="title">songStar</div> <div class="search-wrapper"><div aria-haspopup="listbox" role="combobox" aria-owns="el-autocomplete-4977" class="el-autocomplete search-input no-focused"><div class="el-input el-input--prefix"><!----><input type="text" autocomplete="off" valueKey="title" placeholder="请输入内容" fetchSuggestions="function () { [native code] }" triggerOnFocus="true" debounce="300" placement="bottom-start" popperAppendToBody="true" background-color="#eee" value="" class="el-input__inner"><span class="el-input__prefix"><i class="el-input__icon el-icon-search"></i></span><!----><!----></div><div role="region" class="el-autocomplete-suggestion el-popper" style="width:;display:none;"><div class="el-scrollbar"><div class="el-autocomplete-suggestion__wrap el-scrollbar__wrap el-scrollbar__wrap--hidden-default"><ul class="el-scrollbar__view el-autocomplete-suggestion__list"></ul></div><div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb" style="width:0;transform:translateX(0%);ms-transform:translateX(0%);webkit-transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb" style="height:0;transform:translateY(0%);ms-transform:translateY(0%);webkit-transform:translateY(0%);"></div></div></div></div></div></div> <div class="sidebar-mask" style="display:none;"></div> <ul role="menubar" class="el-menu--horizontal el-menu nav-links" style="background-color:;"><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;border-bottom-color:transparent;background-color:;">
        Home
      </li><li role="menuitem" tabindex="-1" class="el-menu-item is-active" style="color:;border-bottom-color:;background-color:;">
        Blog
      </li><li role="menuitem" aria-haspopup="true" class="el-submenu"><div class="el-submenu__title" style="border-bottom-color:transparent;color:;background-color:;">
          docs
        <i class="el-submenu__icon-arrow el-icon-arrow-down"></i></div><div class="el-menu--horizontal" style="display:none;"><ul role="menu" class="el-menu el-menu--popup el-menu--popup-" style="background-color:;"> <li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;background-color:;">
          es6
        </li><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;background-color:;">
          typescript
        </li><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;background-color:;">
          closure
        </li></ul></div></li><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;border-bottom-color:transparent;background-color:;">
        About
      </li><li role="menuitem" tabindex="-1" class="el-menu-item" style="color:;border-bottom-color:transparent;background-color:;">
        Github
      </li></ul></header> <!----> <div class="page-container"><div class="component-page"><div class="page-content"><!----> <div class="content default"><h1 id="如何在-js-代码中消灭-for-循环"><a href="#如何在-js-代码中消灭-for-循环" aria-hidden="true" class="header-anchor">#</a> 如何在 JS 代码中消灭 for 循环</h1> <p>转自：<a href="https://juejin.im/post/5b5a9451f265da0f6a036346#heading-0" target="_blank" rel="noopener noreferrer">如何在 JS 代码中消灭 for 循环<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="tip custom-block"><p class="custom-block-title">Edit:</p> <p>在我入职公司的第一天，看到代码库里面一堆的 for 循环，内心有些崩溃，于是做了一次技术分享，展示怎样在代码中避免 for 循环。这篇文章是那次分享的总结。至于为什么我提倡避免 for 循环，参考我写的<a href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5c0463226fb9a049bc4c67c0" target="_blank" rel="noopener noreferrer">这篇文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。本文并不完美，其中递归的部分其实不应该在生产环境中用的。重点其实应该是怎样用 reduce 和其它高阶函数，至于这些高阶函数底层用的是 while 循环还是 for 循环，都不重要，我们可以不在乎这些细节。在实际写代码的时候，只要被允许，我都会尽量使用 Ramda。如果对 Ramda 感兴趣，可参考我的另一篇文章<a href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5b810035e51d45389f54d42d" target="_blank" rel="noopener noreferrer">优雅代码指北 -- 巧用 Ramda<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="一，用好-filter，map，和其它-es6-新增的高阶遍历函数"><a href="#一，用好-filter，map，和其它-es6-新增的高阶遍历函数" aria-hidden="true" class="header-anchor">#</a> 一，用好 filter，map，和其它 ES6 新增的高阶遍历函数</h2> <p><strong>问题一：</strong> 将数组中的 falsy 值去除</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arrContainsEmptyVal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> undefined<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">compact</span> <span class="token operator">=</span> arr <span class="token operator">=&gt;</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题二：</strong> 将数组中的 VIP 用户余额加 10</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> username<span class="token punctuation">:</span> <span class="token string">&quot;Kelly&quot;</span><span class="token punctuation">,</span> isVIP<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> balance<span class="token punctuation">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> username<span class="token punctuation">:</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">,</span> isVIP<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> balance<span class="token punctuation">:</span> <span class="token number">19</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> username<span class="token punctuation">:</span> <span class="token string">&quot;Stephanie&quot;</span><span class="token punctuation">,</span> isVIP<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> balance<span class="token punctuation">:</span> <span class="token number">30</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>users<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
  user <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>isVIP <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token operator">...</span>user<span class="token punctuation">,</span> balance<span class="token punctuation">:</span> user<span class="token punctuation">.</span>balance <span class="token operator">+</span> <span class="token number">10</span> <span class="token punctuation">}</span> <span class="token punctuation">:</span> user<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>补充：经网友提醒，这个答案存在浅拷贝的问题。操作引用型数据确实是一个麻烦的问题。下面提供两个方案：
1.用 Ramda：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token constant">R</span> <span class="token keyword">from</span> <span class="token string">&quot;ramda&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> add10IfVIP <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">ifElse</span><span class="token punctuation">(</span>
    <span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">propEq</span><span class="token punctuation">(</span><span class="token string">&quot;isVIP&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">evolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> balance<span class="token punctuation">:</span> <span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">R</span><span class="token punctuation">.</span>identity
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> updateUsers <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>add10IfVIP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">updateUsers</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>2.用 Immer
如果你习惯写 mutable 的代码，可以试下 Immer，用 mutable 的风格写 immutable 的代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> produce <span class="token keyword">from</span> <span class="token string">&quot;immer&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> updatedUsers <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> nextState <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    nextState<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>isVIP<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        user<span class="token punctuation">.</span>balance <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题三：</strong> 判断字符串中是否含有元音字母</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> randomStr <span class="token operator">=</span> <span class="token string">&quot;hdjrwqpi&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">isVowel</span> <span class="token operator">=</span> char <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;o&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;u&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">containsVowel</span> <span class="token operator">=</span> str <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token operator">...</span>str<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>isVowel<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">containsVowel</span><span class="token punctuation">(</span>randomStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题四：</strong> 判断用户是否全部是成年人</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Jim&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">23</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Lily&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">17</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Will&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>users<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>age <span class="token operator">&gt;=</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题五：</strong> 找出上面用户中的第一个未成年人</p> <p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">findTeen</span> <span class="token operator">=</span> users <span class="token operator">=&gt;</span> users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>age <span class="token operator">&lt;</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">findTeen</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题六：</strong> 将数组中重复项清除</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> dupArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">uniq</span> <span class="token operator">=</span> arr <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">uniq</span><span class="token punctuation">(</span>dupArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题七：</strong> 生成由随机整数组成的数组，数组长度和元素大小可自定义</p> <p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">genNumArr</span> <span class="token operator">=</span> <span class="token punctuation">(</span>length<span class="token punctuation">,</span> limit<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length <span class="token punctuation">}</span><span class="token punctuation">,</span> _ <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> limit<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">genNumArr</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="二，理解和熟练使用-reduce"><a href="#二，理解和熟练使用-reduce" aria-hidden="true" class="header-anchor">#</a> 二，理解和熟练使用 reduce</h2> <p><strong>问题八：</strong> 不借助原生高阶函数，定义 reduce</p> <p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">reduce</span> <span class="token operator">=</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> acc<span class="token punctuation">,</span> arr<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> acc<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>head<span class="token punctuation">,</span> <span class="token operator">...</span>tail<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">reduce</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">,</span> tail<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题九：</strong> 将多层数组转换成一层数组</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> nestedArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">flatten</span> <span class="token operator">=</span> arr <span class="token operator">=&gt;</span>
  arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>flat<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> flat<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">flatten</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token punctuation">:</span> next<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题十：</strong> 将下面数组转成对象，key/value 对应里层数组的两个值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> objLikeArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jim&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;single&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">fromPairs</span> <span class="token operator">=</span> pairs <span class="token operator">=&gt;</span>
  pairs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> pair<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>pair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> pair<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fromPairs</span><span class="token punctuation">(</span>objLikeArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题十一：</strong> 取出对象中的深层属性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> deepAttr <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token punctuation">{</span> b<span class="token punctuation">:</span> <span class="token punctuation">{</span> c<span class="token punctuation">:</span> <span class="token number">15</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">pluckDeep</span> <span class="token operator">=</span> path <span class="token operator">=&gt;</span> obj <span class="token operator">=&gt;</span>
  path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> attr<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">pluckDeep</span><span class="token punctuation">(</span><span class="token string">&quot;a.b.c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>deepAttr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题十二：</strong> 将用户中的男性和女性分别放到不同的数组里：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Adam&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> sex<span class="token punctuation">:</span> <span class="token string">&quot;male&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Helen&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">27</span><span class="token punctuation">,</span> sex<span class="token punctuation">:</span> <span class="token string">&quot;female&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Amy&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">,</span> sex<span class="token punctuation">:</span> <span class="token string">&quot;female&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Anthony&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">,</span> sex<span class="token punctuation">:</span> <span class="token string">&quot;male&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">partition</span> <span class="token operator">=</span> <span class="token punctuation">(</span>arr<span class="token punctuation">,</span> isValid<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">[</span>pass<span class="token punctuation">,</span> fail<span class="token punctuation">]</span><span class="token punctuation">,</span> elem<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token function">isValid</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">...</span>pass<span class="token punctuation">,</span> elem<span class="token punctuation">]</span><span class="token punctuation">,</span> fail<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span>pass<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>fail<span class="token punctuation">,</span> elem<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token keyword">const</span> <span class="token function-variable function">isMale</span> <span class="token operator">=</span> person <span class="token operator">=&gt;</span> person<span class="token punctuation">.</span>sex <span class="token operator">===</span> <span class="token string">&quot;male&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>maleUser<span class="token punctuation">,</span> femaleUser<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">partition</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> isMale<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题十三：</strong> reduce 的计算过程，在范畴论里面叫 catamorphism，即一种连接的变形。和它相反的变形叫 anamorphism。现在我们定义一个和 reduce 计算过程相反的函数 unfold（注：reduce 在 Haskell 里面叫 fold，对应 unfold）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">unfold</span> <span class="token operator">=</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> seed<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">go</span> <span class="token operator">=</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> seed<span class="token punctuation">,</span> acc<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res <span class="token operator">?</span> <span class="token function">go</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> acc<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> acc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">go</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> seed<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>根据这个 unfold 函数，定义一个 Python 里面的 range 函数。</p> <p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">range</span> <span class="token operator">=</span> <span class="token punctuation">(</span>min<span class="token punctuation">,</span> max<span class="token punctuation">,</span> step <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">unfold</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x <span class="token operator">&lt;</span> max <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> x <span class="token operator">+</span> step<span class="token punctuation">]</span><span class="token punctuation">,</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="三，用递归代替循环（可以break！）"><a href="#三，用递归代替循环（可以break！）" aria-hidden="true" class="header-anchor">#</a> 三，用递归代替循环（可以break！）</h2> <div class="tip custom-block"><p class="custom-block-title">Edit:</p> <p>虽然递归爆栈的问题可以用代码解决，但递归确实性能赶不上循环。这部分内容纯粹当做递归函数案例了。如何解决递归爆栈，可以参考我的另一篇文章<a href="https://link.juejin.im?target=https%3A%2F%2Fjuejin.im%2Fpost%2F5b5bce21f265da0f6b7710fb" target="_blank" rel="noopener noreferrer">不懂递归？读完这篇保证你懂<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p><strong>问题十四：</strong> 将两个数组每个元素一一对应相加。注意，第二个数组比第一个多出两个，不要把第二个数组遍历完。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> num1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> num2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">zipWith</span> <span class="token operator">=</span> f <span class="token operator">=&gt;</span> xs <span class="token operator">=&gt;</span> ys <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> ys<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>xHead<span class="token punctuation">,</span> <span class="token operator">...</span>xTail<span class="token punctuation">]</span> <span class="token operator">=</span> xs<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>yHead<span class="token punctuation">,</span> <span class="token operator">...</span>yTail<span class="token punctuation">]</span> <span class="token operator">=</span> ys<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token function">f</span><span class="token punctuation">(</span>xHead<span class="token punctuation">)</span><span class="token punctuation">(</span>yHead<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token function">zipWith</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">(</span>xTail<span class="token punctuation">)</span><span class="token punctuation">(</span>yTail<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> x <span class="token operator">=&gt;</span> y <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>

<span class="token function">zipWith</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">(</span>num1<span class="token punctuation">)</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题十五：</strong> 将 Stark 家族成员提取出来。注意，目标数据在数组前面，使用 filter 方法遍历整个数组是浪费。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> houses <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;Eddard Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Catelyn Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Rickard Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Brandon Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Rob Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Sansa Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Arya Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Bran Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Rickon Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Lyanna Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Tywin Lannister&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Cersei Lannister&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Jaime Lannister&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Tyrion Lannister&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Joffrey Baratheon&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">takeWhile</span> <span class="token operator">=</span> f <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>head<span class="token punctuation">,</span> <span class="token operator">...</span>tail<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">f</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span>head<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token function">takeWhile</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">(</span>tail<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">isStark</span> <span class="token operator">=</span> name <span class="token operator">=&gt;</span> name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;stark&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">takeWhile</span><span class="token punctuation">(</span>isStark<span class="token punctuation">)</span><span class="token punctuation">(</span>houses<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题十六：</strong> 找出数组中的奇数，然后取出前4个：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> numList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">takeFirst</span> <span class="token operator">=</span> <span class="token punctuation">(</span>limit<span class="token punctuation">,</span> f<span class="token punctuation">,</span> arr<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>limit <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> arr<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>head<span class="token punctuation">,</span> <span class="token operator">...</span>tail<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token punctuation">[</span>head<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token function">takeFirst</span><span class="token punctuation">(</span>limit <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> f<span class="token punctuation">,</span> tail<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">:</span> <span class="token function">takeFirst</span><span class="token punctuation">(</span>limit<span class="token punctuation">,</span> f<span class="token punctuation">,</span> tail<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">isOdd</span> <span class="token operator">=</span> n <span class="token operator">=&gt;</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token function">takeFirst</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> isOdd<span class="token punctuation">,</span> numList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="四，使用高阶函数遍历数组时可能遇到的陷阱"><a href="#四，使用高阶函数遍历数组时可能遇到的陷阱" aria-hidden="true" class="header-anchor">#</a> 四，使用高阶函数遍历数组时可能遇到的陷阱</h2> <p><strong>问题十七：</strong> 从长度为 100 万的随机整数组成的数组中取出偶数，再把所有数字乘以 3</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 用我们刚刚定义的辅助函数来生成符合要求的数组</span>
<span class="token keyword">const</span> bigArr <span class="token operator">=</span> <span class="token function">genNumArr</span><span class="token punctuation">(</span><span class="token number">1e6</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>能运行的答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">isEven</span> <span class="token operator">=</span> num <span class="token operator">=&gt;</span> num <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">triple</span> <span class="token operator">=</span> num <span class="token operator">=&gt;</span> num <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>

bigArr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isEven<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>triple<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意，上面的解决方案将数组遍历了两次，无疑是浪费。如果写 for 循环，只用遍历一次：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bigArr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEven</span><span class="token punctuation">(</span>bigArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">triple</span><span class="token punctuation">(</span>bigArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在我的电脑上测试，先 filter 再 map 的方法耗时 105.024 ms，而采用 for 循环的方法耗时仅 25.598 ms！那是否说明遇到此类情况必须用 for 循环解决呢? No！</p> <h2 id="五，死磕到底，transduce！"><a href="#五，死磕到底，transduce！" aria-hidden="true" class="header-anchor">#</a> 五，死磕到底，Transduce！</h2> <p>我们先用 reduce 来定义 filter 和 map，至于为什么这样做等下再解释。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">filter</span> <span class="token operator">=</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> arr<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> acc<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">map</span> <span class="token operator">=</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> arr<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>acc<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>重新定义的 filter 和 map 有共有的逻辑。我们把这部分共有的逻辑叫做 reducer。有了共有的逻辑后，我们可以进一步地抽象，把 reducer 抽离出来，然后传入 filter 和 map：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">filter</span> <span class="token operator">=</span> f <span class="token operator">=&gt;</span> reducer <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>acc<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">reducer</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> acc<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">map</span> <span class="token operator">=</span> f <span class="token operator">=&gt;</span> reducer <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>acc<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reducer</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> <span class="token function">f</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>现在 filter 和 map 的函数 signature 一样，我们就可以进行函数组合（function composition）了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">pushReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>acc<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>acc<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">;</span>

bigNum<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>triple<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span>isEven<span class="token punctuation">)</span><span class="token punctuation">(</span>pushReducer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>但是这样嵌套写法易读性太差，很容易出错。我们可以写一个工具函数来辅助函数组合：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">pipe</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>fns<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> fns<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fx<span class="token punctuation">,</span> fy<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fy</span><span class="token punctuation">(</span>fx<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后我们就可以优雅地组合函数了：</p> <div class="language-js extra-class"><pre class="language-js"><code>bigNum<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
  <span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">filter</span><span class="token punctuation">(</span>isEven<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">map</span><span class="token punctuation">(</span>triple<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">(</span>pushReducer<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>经过测试（用 <code>console.time()/console.timeEnd()</code>）,上面的写法耗时 33.898 ms，仅比 for 循环慢 8 ms。为了代码的易维护性和易读性，这点性能上的微小牺牲，我认为是可以接受的。</p> <p>这种写法叫 transduce。有很多工具库提供了 transducer 函数。比如 <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fcognitect-labs%2Ftransducers-js" target="_blank" rel="noopener noreferrer">transducers-js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。除了用 transducer 来遍历数组，还能用它来遍历对象和其它数据集。功能相当强大。</p> <h2 id="六，for-循环和-for-of-循环的区别"><a href="#六，for-循环和-for-of-循环的区别" aria-hidden="true" class="header-anchor">#</a> 六，for 循环和 for ... of 循环的区别</h2> <p>for ... of 循环是在 ES6 引入 Iterator 后，为了遍历 Iterable 数据类型才产生的。EcmaScript 的 Iterable 数据类型有数组，字符串，Set 和 Map。for ... of 循环属于重型的操作（具体细节我也没了解过），如果用 AirBNB 的 ESLint 规则，在代码中使用 for ... of 来遍历数组是会被禁止的。</p> <p>那么，for ... of 循环应该在哪些场景使用呢？目前我发现的合理使用场景是遍历自定义的 Iterable。来看这个题目：</p> <p><strong>问题十八：</strong> 将 Stark 家族成员名字遍历，每次遍历暂停一秒，然后将当前遍历的名字打印来，遍历完后回到第一个元素再重新开始，无限循环。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> starks <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;Eddard Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Catelyn Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Rickard Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Brandon Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Rob Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Sansa Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Arya Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Bran Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Rickon Stark&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;Lyanna Stark&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>答案：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">repeatedArr</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> arr<span class="token punctuation">[</span>i<span class="token operator">++</span> <span class="token operator">%</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> infiniteNameList <span class="token operator">=</span> <span class="token function">repeatedArr</span><span class="token punctuation">(</span>starks<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">wait</span> <span class="token operator">=</span> ms <span class="token operator">=&gt;</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> name <span class="token keyword">of</span> infiniteNameList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="七，放弃倔强，实在需要用-for-循环了"><a href="#七，放弃倔强，实在需要用-for-循环了" aria-hidden="true" class="header-anchor">#</a> 七，放弃倔强，实在需要用 for 循环了</h2> <p>前面讲到的问题基本覆盖了大部分需要使用 for 循环的场景。那是否我们可以保证永远不用 for 循环呢？其实不是。我讲了这么多，其实是在鼓励大家不要写 for 循环，而不是不用 for 循环。我们常用的数组原型链上的 map，filter 等高阶函数，底层其实是用 for 循环实现的。在需要写一些底层代码的时候，还是需要写 for 循环的。来看这个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code>Number<span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.6</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [0, 1, 2, 3, 4, 5, 6]</span>
</code></pre></div><p>注意，这个例子只是为了好玩。生产环境中不要直接修改 JS 内置数据类型的原型链。原因是 V8 引擎有一个原型链快速推测机制，修改原型链会破坏这个机制，造成性能问题。</p></div> <div class="page-nav"><div class="pre"><!----></div> <div class="next"><!----></div></div> <div class="vcomment content"><div id="vcomments"></div></div></div> <!----></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/my-blog/assets/js/app.d514aa34.js" defer></script><script src="/my-blog/assets/js/6.174b3b94.js" defer></script><script src="/my-blog/assets/js/19.a791327b.js" defer></script>
  </body>
</html>
