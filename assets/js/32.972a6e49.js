(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{473:function(t,a,s){"use strict";s.r(a);var e=s(24),n=Object(e.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"如何用小程序实现类原生app下一条无限刷体验"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何用小程序实现类原生app下一条无限刷体验","aria-hidden":"true"}},[t._v("#")]),t._v(" 如何用小程序实现类原生APP下一条无限刷体验")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://developers.weixin.qq.com/community/develop/article/doc/0000645ae8cf882129c8b471951c13?page=2#comment-list",target:"_blank",rel:"noopener noreferrer"}},[t._v("转自： 如何用小程序实现类原生APP下一条无限刷体验"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"_1-背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-背景","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.背景")]),t._v(" "),s("p",[t._v("如今信息流业务是各大互联网公司争先抢占的一个大面包，为了提高用户的后续消费，产品想出了各种各样的方法，例如在微视中，用户可以无限上拉出下一条视频；在知乎中，也可以无限上拉出下一条回答。这样的操作方式用户体验更好，后续消费也更多。最近几年的时间，微信小程序已经从一颗小小的萌芽成长为参天大树，形成了较大规模的生态，小程序也拥有了一个很大的流量入口。")]),t._v(" "),s("h2",{attrs:{id:"_2-demo体验"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-demo体验","aria-hidden":"true"}},[t._v("#")]),t._v(" 2.demo体验")]),t._v(" "),s("p",[t._v("那如何才能在小程序中实现类原生APP效果的下一条无限刷体验？")]),t._v(" "),s("p",[t._v("这篇文章详细记录了下一条无限刷效果的实现原理，以及细节和体验优化，并将相关代码抽象成一个微信小程序代码片段，有需要的同学可查看demo源码。")]),t._v(" "),s("p",[t._v("线上效果请用微信扫码体验：\n"),s("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/XnmTMacr84XDHzGw8mC8G2ib6PNzvibHaicslN0bX7ZicjHEeFF6rVLzsvyCXicthcHEIFEvVUUKuIAiayAvnG90a3icw/0?wx_fmt=png",alt:""}})]),t._v(" "),s("p",[t._v("小程序demo体验请点击："),s("a",{attrs:{href:"https://developers.weixin.qq.com/s/vIfPUomP7f9a",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developers.weixin.qq.com/s/vIfPUomP7f9a"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"_3-实现原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-实现原理","aria-hidden":"true"}},[t._v("#")]),t._v(" 3.实现原理")]),t._v(" "),s("p",[t._v("出于性能和兼容性考虑，我们尽量采用小程序官方提供的原生组件来实现下一条无限刷效果。我们发现，可以将无限上拉下一篇的文章看作一个竖向滚动的轮播图，又由于每一篇文章的内容长度高于一屏幕高度，所以需要实现文章内部可滚动，以及文章之间可以上拉和下拉切换的功能。")]),t._v(" "),s("p",[t._v("在多次尝试后，我们最终采用了在 "),s("code",[t._v("<swiper></swiper>")]),t._v("组件内部嵌套一个 "),s("code",[t._v("<scroll-view></scroll-view>")]),t._v("组件的方式实现，利用 "),s("code",[t._v("<swiper></swiper>")]),t._v("组件来实现文章之间上拉和下拉切换的功能，利用 "),s("code",[t._v("<scroll-view></scroll-view>")]),t._v("来实现一篇文章内部可上下滚动的功能。")]),t._v(" "),s("p",[t._v("所以页面的dom结构如下所示：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("swiper")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("scroll-swiper"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("circular")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{{false}}"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("vertical")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{{true}}"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("bindchange")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("bindChange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("skip-hidden-item-layout")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{{true}}"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("duration")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{{500}}"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("easing-function")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("easeInCubic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("block")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("wx:")]),t._v("for")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{{articleData}}"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("swiper-item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("scroll-view")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("scroll-top")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("scroll-with-animation")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{{false}}"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("scroll-y")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        content\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("scroll-view")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("swiper-item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("block")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("swiper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n")])])]),s("h2",{attrs:{id:"_4-性能优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-性能优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.性能优化")]),t._v(" "),s("p",[t._v("我们知道view部分是运行在webview上的，所以前端领域的大多数优化方式都有用。例如减少代码包体积，使用分包，渲染性能优化等。下面主要讲一下渲染性能优化。")]),t._v(" "),s("h3",{attrs:{id:"_4-1-dom优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-dom优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.1 dom优化")]),t._v(" "),s("p",[t._v("由于页面需要无限上拉刷新，所以要在 "),s("code",[t._v("<swiper></swiper>")]),t._v("组件中不断的增加 "),s("code",[t._v("<swiper-item></swiper-item>")]),t._v("，这样必然会导致页面的dom节点成倍数的增加，最后非常卡顿。")]),t._v(" "),s("p",[t._v("为了优化页面的dom节点，我们利用 "),s("code",[t._v("<swiper></swiper>")]),t._v("的 "),s("code",[t._v("current")]),t._v("和 "),s("code",[t._v("<swiper-item></swiper-item>")]),t._v("的 "),s("code",[t._v("index")]),t._v("来做优化，控制是否渲染dom节点。首先，仅当 "),s("code",[t._v("index <= current + 1")]),t._v("时渲染"),s("code",[t._v("<swiper-item>")]),t._v("，也就是页面中最多预先加载出下一条，而不是将接口返回的所有后续数据都渲染出来；其次，对于用户已经消费过的之前的"),s("code",[t._v("<swiper-item>")]),t._v("，不能直接销毁dom节点，否则会导致"),s("code",[t._v("<swiper>")]),t._v("的current值出现错乱，但是我们可以控制是否渲染"),s("code",[t._v("<swiper-item>")]),t._v("内部的子节点，我们设置了仅当"),s("code",[t._v("current <= index + 1 && index -1 <= current")]),t._v("时才会渲染"),s("code",[t._v("<swiper-item>")]),t._v("中的内容，也就是仅渲染当先文章，及上一篇和下一篇的文章内容，其他文章的dom节点都被销毁了。")]),t._v(" "),s("p",[t._v("这样，无论用户上拉刷新了多少次，页面中最多只会渲染3篇文章的内容，避免了因为上拉次数太多导致的页面卡顿。")]),t._v(" "),s("h3",{attrs:{id:"_4-2-分页时setdata的优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-分页时setdata的优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.2 分页时setData的优化")]),t._v(" "),s("h4",{attrs:{id:"setdata工作原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setdata工作原理","aria-hidden":"true"}},[t._v("#")]),t._v(" setData工作原理")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_jpg/XnmTMacr84XDHzGw8mC8G2ib6PNzvibHaiczlicKVyEoMPLV7b6Mnr5SzJl0XuCUjU0l3OP3uzr5Cyn2pG1gnFSqeA/0?wx_fmt=jpeg",alt:""}}),t._v("\n小程序的视图层目前使用 "),s("code",[t._v("WebView")]),t._v("作为渲染载体，而逻辑层是由独立的 "),s("code",[t._v("JavascriptCore")]),t._v(" 作为运行环境。在架构上， "),s("code",[t._v("WebView")]),t._v(" 和 "),s("code",[t._v("JavascriptCore")]),t._v(" 都是独立的模块，并不具备数据直接共享的通道。当前，视图层和逻辑层的数据传输，实际上通过两边提供的 "),s("code",[t._v("evaluateJavascript")]),t._v(" 所实现。即用户传输的数据，需要将其转换为字符串形式传递，同时把转换后的数据内容拼接成一份 "),s("code",[t._v("JS")]),t._v(" 脚本，再通过执行 "),s("code",[t._v("JS")]),t._v(" 脚本的形式传递到两边独立环境。")]),t._v(" "),s("p",[t._v("而 "),s("code",[t._v("evaluateJavascript")]),t._v(" 的执行会受很多方面的影响，数据到达视图层并不是实时的。")]),t._v(" "),s("ul",[s("li",[t._v("每次 "),s("code",[t._v("setData")]),t._v(" 的调用都是一次进程间通信过程，通信开销与 setData 的数据量正相关。")]),t._v(" "),s("li",[s("code",[t._v("setData")]),t._v(" 会引发视图层页面内容的更新，这一耗时操作一定时间中会阻塞用户交互。")]),t._v(" "),s("li",[s("code",[t._v("setData")]),t._v(" 是小程序开发中使用最频繁的接口，也是最容易引发性能问题的接口。")])]),t._v(" "),s("h4",{attrs:{id:"避免不当使用setdata"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#避免不当使用setdata","aria-hidden":"true"}},[t._v("#")]),t._v(" 避免不当使用setData")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("data")]),t._v(" 应仅包括与页面渲染相关的数据，其他数据可绑定在this上。使用 "),s("code",[t._v("data")]),t._v(" 在方法间共享数据，会增加 setData 传输的数据量，。")]),t._v(" "),s("li",[t._v("使用 "),s("code",[t._v("setData")]),t._v(" 传输大量数据，通讯耗时与数据正相关，页面更新延迟可能造成页面更新开销增加。仅传输页面中发生变化的数据，使用 "),s("code",[t._v("setData")]),t._v(" 的特殊 "),s("code",[t._v("key")]),t._v(" 实现局部更新。")]),t._v(" "),s("li",[t._v("避免不必要的 "),s("code",[t._v("setData")]),t._v("，避免短时间内频繁调用 "),s("code",[t._v("setData")]),t._v("，对连续的setData调用进行合并。不然会导致操作卡顿，交互延迟，阻塞通信，页面渲染延迟。")]),t._v(" "),s("li",[t._v("避免在后台页面进行 "),s("code",[t._v("setData")]),t._v("，这样会抢占前台页面的渲染资源。可将页面切入后台后的 "),s("code",[t._v("setData")]),t._v("调用延迟到页面重新展示时执行。")])]),t._v(" "),s("h4",{attrs:{id:"优化示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化示例","aria-hidden":"true"}},[t._v("#")]),t._v(" 优化示例")]),t._v(" "),s("p",[t._v("无限上拉刷新的数据会采用分页接口的形式，分多次请求回来。在使用分页接口拉取到下一刷的数据后，我们需要调用 "),s("code",[t._v("setData")]),t._v("将数据写进 "),s("code",[t._v("data")]),t._v("的 "),s("code",[t._v("articleData")]),t._v("中，这个 "),s("code",[t._v("articleData")]),t._v("是一个数组，里面存放着所有的文章数据，数据量十分庞大，如果直接 "),s("code",[t._v("setData")]),t._v("会增加通讯耗时和页面更新开销，导致操作卡顿，交互延迟。")]),t._v(" "),s("p",[t._v("为了避免这个问题，我们将 "),s("code",[t._v("articleData")]),t._v("改进为一个二维数组，每一次 "),s("code",[t._v("setData")]),t._v("通过分页的 "),s("code",[t._v("cachedCount")]),t._v("标识来实现局部更新，具体代码如下：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("`articleData[")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("cachedCount"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("]`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  cachedCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cachedCount "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("code",[t._v("articleData")]),t._v("的结构如下：\n"),s("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/XnmTMacr84XDHzGw8mC8G2ib6PNzvibHaic7a9u0Ln5tWBwJW7vKE1Mr1vXAiae27eUHlxFkInuOT5Cya7kLg4DdNA/0?wx_fmt=png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_4-3-体验优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-体验优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.3 体验优化")]),t._v(" "),s("p",[t._v("解决了操作卡顿，交互延迟等问题，我们还需要对动画和交互的体验进行优化，以达到类原生APP效果的体验。")]),t._v(" "),s("p",[t._v("在文章间上拉切换时，我们使用了 "),s("code",[t._v("<swiper></swiper>")]),t._v("组件自带的动画效果，并通过设置 "),s("code",[t._v("duration")]),t._v("和 "),s("code",[t._v("easing-function")]),t._v("来优化滚动细节和动画。")]),t._v(" "),s("p",[t._v("当用户阅读文章到底部时，会提示下一篇文章的标题等信息，而在页面上拉时，由于下一篇文章的内容已经加载出来了，这样在滑动过程中会出现两个重复的标题。为了避免这种情况出现，我们通过一个占满屏幕宽高的空白 "),s("code",[t._v("<view></view>")]),t._v("来将下一篇文章的内容撑出屏幕，并在滚动结束时，通过 "),s("code",[t._v('hidden="'+t._s(t.index!==t.current&&t.index!==t.current+1)+'"')]),t._v("来隐藏这个空白 "),s("code",[t._v("<view></view>")]),t._v("，并对这个空白 "),s("code",[t._v("<view></view>")]),t._v("的高度变化增加动画，来实现下一篇文章从屏幕底部滚动到屏幕顶部的效果：")]),t._v(" "),s("div",{staticClass:"language-css extra-class"},[s("pre",{pre:!0,attrs:{class:"language-css"}},[s("code",[s("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".fake-scroll")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 100%"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 100%"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("transition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" height 0.3s "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cubic-bezier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0.167,0.167,0.4,1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/XnmTMacr84XDHzGw8mC8G2ib6PNzvibHaicFYQAKfJvuIloYeAib12LkeuYMRcxOEAeLZPtpkwmhoYOy3D3DbHps0g/0?wx_fmt=png",alt:""}}),t._v('\n而当用户想要上拉查看之前阅读过的文章时，我们需要给用户一个"下滑查看上一条"提示，所以也可以采用同上的方式，通过一个占满屏幕宽高的提示语 '),s("code",[t._v("<view></view>")]),t._v("来将上一篇文章的内容撑出屏幕，并在滚动结束时，通过 "),s("code",[t._v('wx:if="'+t._s(t.index+1===t.current)+'"')]),t._v("来隐藏这个提示语 "),s("code",[t._v("<view></view>")]),t._v("，并对这个提示语 "),s("code",[t._v("<view></view>")]),t._v('的透明度变化增加动画，来实现下拉时提示"下滑查看上一条"的效果：')]),t._v(" "),s("div",{staticClass:"language-css extra-class"},[s("pre",{pre:!0,attrs:{class:"language-css"}},[s("code",[s("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".fake-previous")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 100%"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 100%"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("opacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("transition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" opacity 1s ease-in"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".fake-previous.show-fake-previous")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("opacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("至此，这个类原生APP效果的下一条无限刷体验的需求的所有要点和细节都已实现。")]),t._v(" "),s("p",[t._v("记录在此，欢迎交流和讨论。")]),t._v(" "),s("p",[t._v("小程序demo体验请点击："),s("a",{attrs:{href:"https://developers.weixin.qq.com/s/vIfPUomP7f9a",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developers.weixin.qq.com/s/vIfPUomP7f9a"),s("OutboundLink")],1)])])},[],!1,null,null,null);n.options.__file="miniapp-infiniteRefresh.md";a.default=n.exports}}]);